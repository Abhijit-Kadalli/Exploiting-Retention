from selenium import webdriver
import os
from webdriver_manager.chrome import ChromeDriverManager 
from selenium import webdriver 
from selenium.webdriver.chrome.service import Service as ChromeService
import argparse
import time

def main(url, number_of_screenshots):
    
    # Create a new instance of the Chrome driver
    driver = webdriver.Chrome(service=ChromeService(ChromeDriverManager().install()))
    driver.maximize_window()

    # Get the URL
    driver.get(url)

    # wait for 5 seconds
    time.sleep(5)
    
    url = url.split('/')

    # create a text list for storing comments
    text_list = []
    author_list = []

    # authors screenshot
    css_selector_author_post= "#t3_" + url[6]
    element_author_post = driver.find_element(by='css selector', value=css_selector_author_post)
    author_text_post = element_author_post.get_attribute("post-title")
    
    # make directory   
    directory = "comment_screenshots/"+ author_text_post.replace(" ", "_").replace("?", "").replace(":", "").replace("/", "_").replace("\\", "").replace("*", "").replace("\"", "").replace("<", "").replace(">", "").replace("|", "")
    if not os.path.exists(directory):
        os.makedirs(directory)

    element_author_post.screenshot(directory + "/" + "author.png")
    
    # take screenshots
    for i in range(number_of_screenshots):
        # CSS selector
        css_selector = "#comment-tree > shreddit-comment:nth-child(" + str(i+1) + ")"
        
        # find the comment element using CSS selector
        element = driver.find_element(by='css selector', value=css_selector)
        
        # take screenshot
        element.screenshot(directory + "/" + "comment_" + str(i+1) + ".png")

        # get the text of the comment
        text = element.find_elements(by='tag name', value='p')
        
        # get the author of the comment
        author = element.get_attribute('author')
        
        # add the text and author to the list
        text_list.append(text)
        author_list.append(author)
    
    # write the text list to a text file
    with open(directory + "/" + "comments.txt", 'w') as f:
        f.write("Title:%s\n" % author_text_post)
        for i in range(len(author_list)):
            f.write("\n")
            for p in text_list[i]:
                f.write("%s. " % p.text)


    driver.quit()

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--url", type=str, help="URL of the website")
    parser.add_argument("--number_of_screenshots", type=int, help="Number of screenshots")
    args = parser.parse_args()
    main(args.url, args.number_of_screenshots)