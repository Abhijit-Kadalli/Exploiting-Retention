import requests
import os

path = "comment_screenshots"

directories = os.listdir(path)

tts = []

for directory in directories:
    if directory != ".DS_Store":
        with open(path + "/" + directory + "/" + "comments.txt", 'r') as f:
            lines = f.readlines()
            for line in lines:
                if line[0] != "\n":
                    line = line.replace("\n", "")
                    tts.append(line)

speeches = []
for speech in tts:
        url = "http://192.168.0.105:5002/api/tts"
        payload = {
        "voice": "en-us/ljspeech-glow_tts",
        "text": speech,
        "vocoder": "hifi_gan/universal_large",
        "denoiserStrength": 0.005,
        "noiseScale": 0.666,
        "lengthScale": 0.85
        }
        headers = {
        "Content-Type": "application/json",
        "Accept": "*/*"
        }
        try:
            response = requests.get(url, params=payload, headers=headers)
        except requests.exceptions.RequestException as e:
            print(e)
        
        if response.status_code == 200:
            speeches.append(response.content)

for dir in directories:
    dirs = os.listdir(os.path.join(path,dir))
    for audio_name in dirs:
        if audio_name != "comments.txt":
            audio_name = audio_name.replace(".png", ".wav")
            with open(os.path.join(os.path.join(path,dir),audio_name), 'wb') as f:
                f.write(speeches.pop(0))